<html>
	<head>
	<style>
	#mapid { height: 180px; }
	</style>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" integrity="sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ==" crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js" integrity="sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg==" crossorigin="">

	</script>
	</head>

	<body>
	<div id="mapid" style="width: 600px; height: 400px;"></div>
	<script>
		var mymap = L.map('mapid').setView([51.505, -0.09], 13);

		L.tileLayer
		(
			'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw',
			{
				maxZoom: 18,
				/*attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',*/
				id: 'mapbox.streets'
			}
		).addTo(mymap);

	function put_marker_text(x, y, text, id)
	{
		var marker = L.marker([y, x]).addTo(mymap);
		marker.bindPopup(text+"ID: "+id).openPopup();
	}
	
	function put_marker(x, y, id)
	{
		var marker = L.marker([y, x]).addTo(mymap);
		marker.bindPopup("ID: "+id).openPopup();
	}
	
	function pulse(x, step, beginradius, minradius, maxradius)
	{
		x.step = step;
		var radius = beginradius;
		function f()
		{
			radius+=x.step;
			x.setRadius(radius);
			if (radius > maxradius)
			{
				x.step = -x.step;
			}
			else if (radius < minradius)
			{
				x.step = -x.step;
			}
		}
		setInterval(f, 80);
	}

	function set_safe_radar(x, y)
	{
		var newcircle = set_circle(x, y, 'blue', 'blue', 0.2, 50);
		newcircle.addTo(mymap);
	}

	function set_pulsar(x, y)
	{
		var newcircle = set_circle(x, y, 'red', 'red', 0.2, 50);
		newcircle.addTo(mymap);
		move(newcircle, 9, 5, 4, 300);
	}

	function set_safe_pulsar(x, y)
	{
		var newcircle = L.circle([y, x], {
		color: 'blue',
		fillColor: 'blue',
		fillOpacity: 0.2,
		radius: 10
		}).addTo(mymap);
		move(newcircle, 9, 5, 4, 70);
	}

	function set_multipulsar(x, y, amount)
	{
		var circ_amount = 0;
		function put_pulsar()
		{
			if (circ_amount < amount)
			{
				++circ_amount;
				set_pulsar(x, y);
			}
		}
		if (circ_amount < amount) setInterval(put_pulsar, 400);
	}

	function set_napalm(x, y)
	{
		put_marker_text(x, y, "Fire detected.<br>Emergency!<br>", 594519)
		set_multipulsar(x, y, 5);
	}

	function set_safe(x, y)
	{
		put_marker(x, y, 594520)
		set_safe_pulsar(x, y, 5);
	}

	function set_circle(x, y, line_color, fill_color, opacity, radius)
	{
		var newcircle = L.circle([y, x], {
		color: line_color,
		fillColor: fill_color,
		fillOpacity: opacity,
		radius: radius
		});
		return newcircle;
	}
	
	/*
	function core()
	{
		
	}
	*/
	function router()
	{
		
	}



	function sensor(x, y, id)
	{
		var newsensor =
		{
			circ: set_circle(x, y, 'blue', 'blue', 0.2, 20),
			x: x,
			y: y,
			id: id
		};
		//alert("dot (x, y) = ("+x+", "+y+").");
		return newsensor;
	}

	function set_on_fire(sensor, step)
	{
		newsensor1.circ.removeFrom(mymap);
		sensor.circ = set_circle(sensor.x, sensor.y, 'red', 'red', 0.3, 0);
		sensor.circ.addTo(mymap);
		var radius = 0;
		function f()
		{
			radius+=step;
			sensor.circ.setRadius(radius);
		}
		setInterval(f, 80);
	}

	function newlink(A, B)
	{
		var latlngs = [L.latLng(A.y, A.x), L.latLng(B.y, B.x)];
		var line = L.polyline(latlngs, {color: 'green'});
		//alert("Adot (x, y) = ("+A.x+", "+A.y+"); Bdot (x, y) = ("+B.x+", "+B.y+")");
		return line;
	}

	var newsensor1 = sensor(-0.09, 51.5, "timur");
	newsensor1.circ.addTo(mymap);

	//alert("Adot (x, y) = ("+newsensor1.x+", "+newsensor1.y+")");
	//alert("Adot (x, y) = ("+newsensor1.x+", "+newsensor1.y+"); Bdot (x, y) = ("+newsensor2.x+", "+newsensor2.y+")");

	var newsensor2 = sensor(-0.0905, 51.505, "dog");
	newsensor2.circ.addTo(mymap);
	
		
	var line = newlink(newsensor1, newsensor2).addTo(mymap);
	
	//newsensor1.circ = set_circle(x, y, 'red', 'red', 0.3, 40).addTo(mymap);
	//newsensor1.circ
	//set_circle(-0.09, 51.5, 'red', 'red', 0.3, 40).addTo(mymap);
	
	set_on_fire(newsensor1, 0.3);

	/*
	autoupdate;
	read {BASE}
	for (id)
		display(sh, dg);
	*/
	</script>
	</body>
</html>